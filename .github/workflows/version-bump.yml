name: version-bump

on:
  pull_request:
    branches:
      - main
    types: [opened, reopened, edited, synchronize, ready_for_review]

permissions:
  contents: read
  pull-requests: write
  issues: write
  actions: read

concurrency:
  group: pr-${{ github.workflow }}-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  version-bump:
    if: ${{ !github.event.pull_request.draft && github.event.pull_request.head.repo.full_name == github.repository }}
    runs-on: ubuntu-latest
    steps:
      - name: Version bump via sudden-agent
        uses: sudden-network/agent@v1
        with:
          agent_auth_file: ${{ secrets.CODEX_AUTH_JSON }}
          resume: true
          prompt: |
            Goal: keep the package.json version aligned with the impact of changes.

            Review the PR changes and decide whether a version bump is needed:
            - Breaking changes -> major.
            - New backward compatible features -> minor.
            - Changes that alter the agent's behavior or outputs -> minor.
            - Backward compatible bug fixes, security fixes, dependency updates -> patch.
            - Internal-only changes, no runtime changes -> none.

            If you recommend a bump:
            - Comment on the PR with a short summary explaining the reason for the bump.
            - Include the current version and the proposed version in a diff-style code fence:
              ```diff
              - version: <current>
              + version: <proposed>
              ```
            If you do not recommend a bump, do not comment.
